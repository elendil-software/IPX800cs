name: "Pull Request"
on:
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  init:
    uses: elendil-software/github-actions/.github/workflows/init-workflow.yml@main
  
  gitversion:
    needs: init
    uses: elendil-software/github-actions/.github/workflows/gitversion.yml@main
    with:
      config: './.github/GitVersion.yml'
  
  build:
    needs: gitversion
    uses: elendil-software/github-actions/.github/workflows/dotnet-build.yml@main

  quality:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Download source artifact
        uses: actions/download-artifact@v3
        with:
          name: 'workflow-share'

      - name: Unzip artifact archive
        run: |
          7z x workflow-share.7z
          rm -f workflow-share.7z
        
      - name: 'Qodana Scan'
        uses: JetBrains/qodana-action@main
        env:
          QODANA_TOKEN: ${{ secrets.QODANA_TOKEN }}